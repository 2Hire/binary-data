const symbols = require('internal/symbols')

module.exports = select

function select(...whenTypes) {
  if (whenTypes.length === 0) {
    throw new TypeError('You should set at least one condition type.')
  }

  const result = {
    decode,
    [symbols.skip]: true,
  }

  return result

  function decode(rstream) {
    decode.bytes = 0

    for (const when of whenTypes) {
      // eslint-disable-next-line no-invalid-this
      const probalyValue = when.decode.call(this, rstream)

      if (when[symbols.skip] === true) {
        continue
      }

      decode.bytes = when.decode.bytes

      result[symbols.skip] = false
      return probalyValue
    }

    result[symbols.skip] = true
  }
}
